<!-- /var/www/media_conv/templates/index.html -->
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Audio Converter</title>
</head>
<body>
  <h1>FFmpeg Audio Converter</h1>
  <form id="form">
    <input id="file" type="file" name="file" required />
    <select id="fmt" name="fmt">
      <option value="mp3">mp3</option>
      <option value="wav">wav</option>
      <option value="flac">flac</option>
    </select>
    <button type="submit">変換</button>
  </form>
  <script>
    const form = document.getElementById("form");
    form.onsubmit = async (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      const res = await fetch("/convert?fmt=" + fd.get("fmt"), { method: "POST", body: fd });
      if (!res.ok) { alert("変換エラー"); return; }
      const blob = await res.blob();
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "converted." + fd.get("fmt");
      a.click();
    }
  </script>
</body>
</html>
